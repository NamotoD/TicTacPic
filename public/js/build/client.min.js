/*! tic_tac_pic 2017-02-26 */
function startButton(a){return recognizing?(recognition.stop(),recognizing=!1,void $("#start_button").prop("value","Record")):(final_transcript="",recognition.lang="en-GB",recognition.start(),$("#start_button").prop("value","Recording ... Click to stop."),void $("#msg").val())}function zeroPad(a,b){for(var c=a+"";c.length<b;)c="0"+c;return c}function timeFormat(a){var b=new Date(a);return zeroPad(b.getHours(),2)+":"+zeroPad(b.getMinutes(),2)+":"+zeroPad(b.getSeconds(),2)+" "}var final_transcript="",recognizing=!1,last10messages=[];if("webkitSpeechRecognition"in window){var recognition=new webkitSpeechRecognition;recognition.continuous=!0,recognition.interimResults=!0,recognition.onstart=function(){recognizing=!0},recognition.onresult=function(a){for(var b="",c=a.resultIndex;c<a.results.length;++c)a.results[c].isFinal?(final_transcript+=a.results[c][0].transcript,$("#msg").addClass("final"),$("#msg").removeClass("interim")):(b+=a.results[c][0].transcript,$("#msg").val(b),$("#msg").addClass("interim"),$("#msg").removeClass("final"));$("#msg").val(final_transcript)}}else console.log("webkitSpeechRecognition is not available");var clock1,clock2,countdownToHideTurn,countdownToChangeToNextPlayer1,countdownToChangeToNextPlayer2,countdownToHideGuessButton,setTimeout4,countdownToShowClock,countdown2;$(document).ready(function(){function a(){e=!1,b.emit("typing",!1)}$(".dropup").on("show.bs.dropdown",function(){clearTimeout(countdownToHideGuessButton),setTimeout4=setTimeout(function(){$("#warningBoard").hide(),$("#guessPar").hide(),$("#checkAnswer").hide(),b.emit("ChangeToNextPlayer")},1e4)}),$("#overviewPager").bootpag({total:4,page:1,maxVisible:4,leaps:!0,firstLastUse:!0,first:"←",last:"→",wrapClass:"pagination",activeClass:"active",disabledClass:"disabled",nextClass:"next",prevClass:"prev",lastClass:"last",firstClass:"first"}).on("page",function(a,b){$("#overviewContent").html($("#overview"+b).text())}),$("#rulesPager").bootpag({total:4,page:1,maxVisible:4,leaps:!0,firstLastUse:!0,first:"←",last:"→",wrapClass:"pagination",activeClass:"active",disabledClass:"disabled",nextClass:"next",prevClass:"prev",lastClass:"last",firstClass:"first"}).on("page",function(a,b){$("#rulesContent").html($("#rule"+b).text())});var b=io.connect();b.on("error",function(){b.socket.reconnect()});var c=active=null;$("#score").hide(),$("#checkAnswer").hide(),$("#leave").hide(),$("#start_game_button").hide(),$("#listOfRooms").show();var d="desktop";navigator.userAgent.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i)&&(d="mobile"),b.emit("sendDevice",d),$("form").submit(function(a){a.preventDefault()}),$("#conversation").bind("DOMSubtreeModified",function(){$("#conversation").animate({scrollTop:$("#conversation")[0].scrollHeight})}),$("#name").focus(),$("#join").attr("disabled","disabled"),""===$("#name").val()&&$("#join").attr("disabled","disabled"),$("#name").keypress(function(a){var b=$("#name").val();b.length<2?$("#join").attr("disabled","disabled"):($("#errors").empty(),$("#errors").hide(),$("#join").removeAttr("disabled"))}),$("#errors").hide(),$("#errorsUserName").hide(),$("#chatForm").submit(function(){var a=$("#msg").val();""!==a&&(b.emit("send",(new Date).getTime(),a),$("#msg").val(""))});var e=!1,f=void 0;$("#msg").keypress(function(d){13!==d.which&&(e===!1&&null!==c&&$("#msg").is(":focus")?(e=!0,b.emit("typing",!0)):(clearTimeout(f),f=setTimeout(a,5e3)))}),b.on("isTyping",function(b){b.isTyping?0===$("#"+b.person).length&&($("#updates").append("<li id='"+b.person+"'><span class='text-muted'><small><i class='fa fa-keyboard-o'></i> "+b.person+" is typing.</small></li>"),f=setTimeout(a,5e3)):$("#"+b.person).remove()}),b.on("toggleActive",function(){$("#board").toggleClass("not-active")}),b.on("updateOnCreateOrJoin",function(){$("#createRoom").hide(),$("#listOfRooms").hide(),$("#leave").show(),$(".collapse").collapse("hide"),$("#rooms li").addClass("disabled"),$("#rooms li.disabled a").click(function(){return!1})}),$("#createRoom").click(function(){b.emit("createRoom")}),b.on("updateCreateRoom",function(a){var b=$("#rooms li").find(".badge"),c=Number(b.eq(a.index).text());if(b.eq(Number(a.index)).text(c+1),$(".list-group-item.active").attr("id")===a.s)if($("#listOfRooms").text(""),jQuery.isEmptyObject(a.rooms))$("#listOfRooms").append('<li class="list-group-item text-danger">There are no rooms yet. Press create room button to create your own!</li>');else{var d=0;$.each(a.rooms,function(b,c){if(c.size===a.s){var e="<button id="+b+" data-roomName="+c.name+" class='btn btn-default btn-xs' >Join</button>";$("#listOfRooms").append("<li id="+b+' class="list-group-item"><span>'+c.name+"</span><span>"+c.size+"</span> "+e+" "+c.status+"</li>")}else d<1&&($("#listOfRooms").append('<li class="list-group-item">There are other room sizes available!</li>'),d++)})}}),b.on("updateOwnerLeaveRoom",function(a){var b=$("#rooms li").find(".badge"),c=Number(b.eq(a.index).text());if(b.eq(Number(a.index)).text(c-1),$(".list-group-item.active").attr("id")===a.s)if($("#listOfRooms").text(""),jQuery.isEmptyObject(a.rooms))$("#listOfRooms").append('<li class="list-group-item text-danger">There are no rooms yet. Press create room button to create your own!</li>');else{var d=0;$.each(a.rooms,function(b,c){if(c.size===a.s){var e="<button id="+b+" data-roomName="+c.name+" class='btn btn-default btn-xs' >Join</button>";$("#listOfRooms").append("<li id="+b+' class="list-group-item"><span>'+c.name+"</span><span>"+c.size+"</span> "+e+" "+c.status+"</li>")}else d<1&&($("#listOfRooms").append('<li class="list-group-item">There are other room sizes available!</li>'),d++)})}}),b.on("updatePlayerJoinOrLeaveRoom",function(a){if($(".list-group-item.active").attr("id")===a.s)if($("#listOfRooms").text(""),jQuery.isEmptyObject(a.rooms))$("#listOfRooms").append('<li class="list-group-item text-danger">There are no rooms yet. Press create room button to create your own!</li>');else{var b=0;$.each(a.rooms,function(c,d){if(d.size===a.s){var e="<button id="+c+" data-roomName="+d.name+" class='btn btn-default btn-xs' >Join</button>";$("#listOfRooms").append("<li id="+c+' class="list-group-item"><span>'+d.name+"</span><span>"+d.size+"</span> "+e+" "+d.status+"</li>")}else b<1&&($("#listOfRooms").append('<li class="list-group-item">There are other room sizes available!</li>'),b++)})}}),$("#start_game_button").click(function(){b.emit("startGame")}),$("#rooms").on("click",".removeRoomBtn",function(){alert("remove button works!");var a=$(this).attr("id");b.emit("removeRoom",a),$("#createRoom").show()}),$("#leave").click(function(){var a=c,d=$(".list-group-item.active").attr("id");b.emit("leaveRoom",{roomID:a,roomSize:d}),$("#leave").hide(),$("#createRoom").show()}),$("#logout").click(function(){b.emit("logout"),$("#logout").hide()}),b.on("redirect",function(a){window.location.href=a}),$("#people").on("click",".whisper",function(){var a=$(this).siblings("span").text();$("#msg").val("w:"+a+":"),$("#msg").focus()}),$(document).on("click",".col",function(){$("#turnPar").hide(),$(".clock").hide(),$("#guessPar").hide(),$("#warningBoard").hide(),clearTimeout(countdownToChangeToNextPlayer1),clearTimeout(countdownToChangeToNextPlayer2),clearTimeout(countdownToShowClock),clearTimeout(countdown2);var a=parseInt(this.id);if($("#"+a).parent("div").hasClass("Default")){var d={clickedButtonId:a,myRoomID:c};b.emit("sendClickedButton",d),$("#board").addClass("not-active"),$("#errors").empty(),$("#errors").hide()}else alert("Choose another button!")}),b.on("removeBlinking",function(){$("*[data-index=1]").removeClass("blink_me"),$("*[data-index=2]").removeClass("blink_me"),$("*[data-index=3]").removeClass("blink_me"),$("*[data-index=4]").removeClass("blink_me")}),b.on("showActiveToOthers",function(a){$("*[data-index="+a.NextPlayerToMove.toString()+"]").addClass("blink_me")}),b.on("showActiveToActive",function(a){$("#warningBoard").show(),$("#turnPar").show(),setTimeout(function(){$("#warningBoard").hide(),$("#turnPar").hide()},2e3),countdown2=setTimeout(function(){$("#warningBoard").show(),$(".clock").show(),clock2=$(".clock").FlipClock(5,{clockFace:"MinuteCounter",countdown:!0}),setTimeout(function(){setInterval(function(){clock2.increment()},1e3)})},11e3),countdownToChangeToNextPlayer2=setTimeout(function(){$("#board").addClass("not-active"),$(".clock").css("display","none"),b.emit("ChangeToNextPlayer")},16e3)}),b.on("sendScoresToClients",function(a){$(".player-score:eq("+a.index+")").find(".badge").text(a.score)}),b.on("changeTileOnClick",function(a){$("#"+a.clickedButtonId).parent("div").removeClass("Default").addClass(a.myPlayerTile)}),b.on("setTransparent",function(a){$.each(a.winningSets,function(a,b){$.each(b,function(a,b){$("#"+this).parent("div").addClass("transparent")})})}),b.on("showImage",function(){$("#board > div").css("opacity","0")}),b.on("setUncovered",function(a){$.each(a.winningSets,function(b,c){$.each(c,function(b,c){$("#"+this).parent("div").addClass(a.myPlayerTile+"Uncovered")})})}),b.on("exists",function(a){$("#errors").empty(),$("#errors").show(),$("#errors").append(a.msg+" Try <strong>"+a.proposedName+"</strong>")}),b.on("joined",function(){function a(a){console.log(a)}function c(a){var c=a.coords.latitude,d=a.coords.longitude;$.ajax({type:"GET",url:"http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20geo.placefinder%20where%20text%3D%22"+c+"%2C"+d+"%22%20and%20gflags%3D%22R%22&format=json",dataType:"json",success:function(a){b.emit("countryUpdate",{country:a.query.results.Result.countrycode})}})}$("#errors").hide(),navigator.geolocation?navigator.geolocation.getCurrentPosition(c,a,{enableHighAccuracy:!0}):($("#errors").show(),$("#errors").append("Your browser is ancient and it doesn't support GeoLocation."))}),b.on("history",function(a){0!==a.length?($("#msgs").append("<li><strong><span class='text-warning'>Last 10 messages:</li>"),$.each(a,function(a,b){$("#msgs").append("<li><span class='text-warning'>"+b+"</span></li>")})):$("#msgs").append("<li><strong><span class='text-warning'>No past messages in this room.</li>")}),b.on("update",function(a){$("#msgs").append("<li>"+a+"</li>")}),b.on("showBoard",function(a){$("#msgs").empty(),$("#start_game_button").hide(),$("#logout").hide();for(var c=document.getElementById("gameBoard"),d=document.getElementById("game-area"),e=c.content.cloneNode(!0);d.firstChild;)d.removeChild(d.firstChild);d.appendChild(e);for(var f=0;f<a.playersInRoom.length;f++)$(".player-score:eq("+f+")").find(".glyphicon").append(a.playersInRoom[f].name.substring(0,6)),$(".player-score:eq("+f+")").find(".glyphicon").css("color",a.playersInRoom[f].tileHex);active?($("#board").removeClass("not-active").addClass("active"),$("#warningBoard").show(),$("#turnPar").show(),countdownToHideTurn=setTimeout(function(){$("#warningBoard").hide(),$("#turnPar").hide()},2e3),countdownToShowClock=setTimeout(function(){$("#warningBoard").show(),$(".clock").show(),clock1=$(".clock").FlipClock(5,{clockFace:"MinuteCounter",countdown:!0}),setTimeout(function(){setInterval(function(){clock1.increment()},1e3)})},11e3),countdownToChangeToNextPlayer1=setTimeout(function(){$("#board").addClass("not-active"),$("#warningBoard").hide(),$("#cloc").hide(),b.emit("ChangeToNextPlayer")},16e3)):$("#first").addClass("blink_me"),$("#board").css("background-position",a.randPic+"% 0"),2===a.playersInRoom.length&&($("#first, #second").removeClass("col-md-3"),$("#score").addClass("verticalMiddle")),3===a.playersInRoom.length&&($("#score").addClass("verticalMiddle"),$("#first").removeClass("col-xs-6 col-md-3").addClass("col-xs-4"),$("#second").removeClass("text-right col-xs-6 col-md-3").addClass("col-xs-4 text-center"),$("#third").removeClass("text-left col-xs-6 col-md-3 hidden").addClass("col-xs-4 text-right")),4===a.playersInRoom.length&&($("#third, #fourth, #nextLine").removeClass("hidden"),$("#nextLine").addClass("clearfix visible-xs-block")),$("#lobby").hide(),$("#score").show(),$("#game-area").removeClass("before").addClass("after"),$("#chat").removeClass("before").addClass("after");var g=$("#picture-choice");g.empty(),$.each(a.picNames,function(a,b){g.append('<li><a href="#">'+b+"</a></li>")})}),b.on("unhideBackground",function(){$("#board").css("background-size","3700%")}),b.on("enableCheckAnswerButton",function(a){$("#checkAnswer").show(),$("#guessPar").show(),$("#warningBoard").show(),countdownToHideGuessButton=setTimeout(function(){$("#warningBoard").hide(),$("#guessPar").hide(),$("#checkAnswer").hide(),b.emit("ChangeToNextPlayer")},5e3)}),b.on("disableCheckAnswerButton",function(){$("#checkAnswer").hide()}),$("body").on("click","#picture-choice li",function(){clearTimeout(setTimeout4),$("#guessPar").hide();var a=!1,c=$(this).text();b.emit("checkAnswer",c,function(d){a=d.result,d.score=0,a?(d.score+=100,$("#errors").empty(),$("#errors").hide()):(d.score-=50,$("#errors").empty(),$("#errors").show(),$("#errors").append("<i>"+c+"</i> is a wrong answer. You re losing 50 points."+d.attempts+"attempts left!")),b.emit("adjustScore",d)})}),b.on("update-people",function(a){$("#people").empty(),$("#listOfPeople").empty(),$("#people").append('<li class="list-group-item active">People online <span class="badge">'+a.count+"</span></li>"),$.each(a.people,function(a,b){"country"in b?html='<img class="flag flag-'+b.country+'"/>':html="",$("#listOfPeople").append('<li class="list-group-item"><span>'+b.name+'</span> <i class="fa fa-'+b.device+'"></i> '+html+' <a href="#" class="whisper btn btn-xs">whisper</a></li>')})}),b.on("chat",function(b,c,d){$("#msgs").append("<li><strong><span class='text-success'>"+timeFormat(b)+c.name+"</span></strong>: "+d+"</li>");var e=0;$("#msgs li").each(function(a,b){e+=parseInt($(this).height())}),e+="",$("#msgs").animate({scrollTop:e}),$("#"+c.name).remove(),clearTimeout(f),f=setTimeout(a,0)}),b.on("whisper",function(a,b,c){"You"===b.name?s="whisper":s="whispers",$("#msgs").append("<li><strong><span class='text-muted'>"+timeFormat(a)+b.name+"</span></strong> "+s+": "+c+"</li>")}),$("body").on("click","#rooms li",function(){$("#listOfPeople").hide(),$("#listOfRooms").toggle("slow"),$("#listOfRooms").text(""),b.emit("sendRoomSize",$(this).attr("id"))}),$("body").on("click","#people li",function(){$("#listOfRooms").hide(),$("#listOfPeople").toggle("slow")}),b.on("reloadPage",function(a){$("#msgs").append("<li><strong><span class='text-warning'>Changing the room size...</span></strong></li>"),window.location.href="/room"}),$("body").on("click","#listOfRooms li",function(){b.emit("joinRoom",{id:$(this).attr("id")})}),b.on("roomList",function(a){if($("#rooms").text(""),$("#rooms").append('<div class="row-fluid no-gutter-at-all" ><div class="col-xs-4 " ><li id = "Large" class="list-group-item" role="presentation"><a href="#">Large <span class="badge">'+("undefined"!=typeof a.count.large?a.count.large:0)+'</span></a></li></div><div class="col-xs-4 " ><li id = "Medium" class="list-group-item" role="presentation"><a href="#">Medium <span class="badge">'+("undefined"!=typeof a.count.medium?a.count.medium:0)+'</span></a></li></div><div class="col-xs-4 " ><li id = "Small" class="list-group-item" role="presentation"><a href="#">Small <span class="badge">'+("undefined"!=typeof a.count.small?a.count.small:0)+"</span></a></li></div></div>"),jQuery.isEmptyObject(a.rooms))$("#listOfRooms").append('<li class="list-group-item text-danger">There are no rooms yet. Press create room button to create your own!</li>');else{var b=0;$.each(a.rooms,function(c,d){if(d.size===a.s){var e="<button id="+c+" data-roomName="+d.name+" class='btn btn-default btn-xs' >Join</button>";$("#listOfRooms").append("<li id="+c+' class="list-group-item"><span>'+d.name+"</span><span>"+d.size+"</span> "+e+" "+d.status+"</li>")}else b<1&&($("#msgs").append('<li class="text-success">There are other room sizes available! </li>'),b++)})}$("#rooms li").removeClass("active"),$("#"+a.s).addClass("active")}),b.on("updateActive",function(a){$("#rooms li").removeClass("active"),$("#"+a.s).addClass("active")}),b.on("sendRoomID",function(a){c=a.id,active=a.active}),b.on("changeActiveBoard",function(a){active=a.active,$("#board").removeClass("active").addClass("not-active"),$("#warningBoard").hide(),clearTimeout(countdownToChangeToNextPlayer1),clearTimeout(countdownToChangeToNextPlayer2),clearTimeout(countdownToHideGuessButton),clearTimeout(countdownToShowClock),clearTimeout(countdown2)}),b.on("showStartButton",function(a){$("#start_game_button").show()}),b.on("hideStartButton",function(a){$("#start_game_button").hide()}),b.on("disableBoard",function(a){$("#board").addClass("not-active"),$("#warningBoard").hide()}),b.on("endGame",function(a,b){$("#msgs").append("<li><strong><span class='text-warning'>"+b+"</span></strong></li>"),$("#checkAnswer").hide(),$("#board").addClass("not-active")}),b.on("disconnect",function(){$("#msgs").append("<li><strong><span class='text-warning'>The server is not available</span></strong></li>"),$("#msg").attr("disabled","disabled"),$("#send").attr("disabled","disabled")})});